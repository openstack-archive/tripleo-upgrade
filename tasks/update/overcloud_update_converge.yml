---
- name: import tasks from l3_agent_connectivity_check_start_script
  import_tasks: ../common/l3_agent_connectivity_check_start_script.yml

- name: run minor update converge step
  shell: |
        set -o pipefail
        openstack overcloud update converge -y 2>&1 {{ timestamper_cmd }} >> \
        overcloud_update_converge.log
  args:
    chdir: "{{ working_dir }}"
    executable: /usr/bin/bash
  environment:
    OS_CLOUD: undercloud
  register: overcloud_converge_update
  ignore_errors: true

- name: was the overcloud update converge successful.
  fail: msg="Overcloud update converge step failed... :("
  when:
    - overcloud_converge_update.rc != 0

- name: import tasks from l3_agent_connectivity_check_stop_script
  import_tasks: ../common/l3_agent_connectivity_check_stop_script.yml
  vars:
    current_stage_error: "{{ update_loss_threshold }}"
