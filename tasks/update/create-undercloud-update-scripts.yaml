---
- name: Ensure we skip Rhel Enforcement
  include_tasks: ../common/skip_rhel_enforcement.yaml
  when: not ( enforce_rhel|bool )

- name: create undercloud update script
  template:
    src: undercloud_upgrade.sh.j2
    dest: "{{ undercloud_update_script }}"
    mode: 0775
    force: true

- name: create update workaround scripts for undercloud
  template:
    src: workarounds.sh.j2
    dest: "{{ working_dir }}/{{ item }}.sh"
    mode: 0775
    force: true
  loop:
    - 'pre_undercloud_update_workarounds'
    - 'post_undercloud_update_workarounds'
  when: updates_workarounds|bool

- name: create IPA permission script
  template:
    src: ipa-permission.sh.j2
    dest: "{{ working_dir }}/ipa-permission.sh"
    mode: 0775
    force: true

- name: collect log for the current stage - batch
  include_tasks: ../common/create_log_collection_scripts.yml
  vars:
    log_current_stage: 'before_undercloud_update'
  when:
    - log_stages|bool
