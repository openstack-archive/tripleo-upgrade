---
- name: run overcloud major upgrade for the host {{ host }}
  shell: |
    set -o pipefail
    bash {{ overcloud_upgrade_run_script_base }}-{{ host }}.sh 2>&1 {{ timestamper_cmd }} > \
        {{ working_dir }}/overcloud_upgrade_run_{{ host }}.log
  register: overcloud_upgrade_res
  ignore_errors: true

- name: was the overcloud upgrade composable step successful.
  fail: msg="Overcloud upgrade composable step failed for {{ host }}... :("
  when: overcloud_upgrade_res.rc != 0
